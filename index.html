<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Tracker & Stopwatch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .timer-display {
            font-variant-numeric: tabular-nums;
        }
        /* Custom scrollbar for a cleaner look */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <main class="w-full max-w-lg mx-auto bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8">
        
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-cyan-400">Study Tracker</h1>
            <p class="text-gray-400 mt-2">Track your focus, analyze your progress.</p>
        </div>

        <div class="bg-gray-900 rounded-xl p-6 mb-6 text-center">
            <p id="timer" class="text-6xl md:text-7xl font-black text-white timer-display tracking-wider">00:00:00</p>
        </div>

        <!-- Subject Input -->
        <div class="mb-4">
             <input type="text" id="subjectInput" placeholder="What are you studying?" class="w-full bg-gray-700 border-2 border-gray-600 rounded-lg py-2 px-4 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition">
             <p id="subjectError" class="text-red-400 text-sm mt-1 h-4"></p>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <button id="startButton" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 shadow-lg focus:outline-none focus:ring-4 focus:ring-cyan-500/50">
                Start
            </button>
            <button id="stopButton" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 shadow-lg focus:outline-none focus:ring-4 focus:ring-pink-500/50" disabled>
                Stop
            </button>
        </div>
        
        <!-- Tabs for Different Views -->
        <div class="border-b border-gray-700 mb-4">
            <nav class="flex -mb-px space-x-4" aria-label="Tabs">
                <button id="tab-today" class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-cyan-400 text-cyan-400">Today's Log</button>
                <button id="tab-weekly" class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-400 hover:text-white hover:border-gray-300">Weekly Analysis</button>
                <button id="tab-monthly" class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-400 hover:text-white hover:border-gray-300">Monthly Analysis</button>
            </nav>
        </div>

        <!-- Views Container -->
        <div id="view-container" class="bg-gray-900/50 rounded-lg p-4 h-64 overflow-y-auto custom-scrollbar">
            <!-- Today's Log View -->
            <div id="view-today">
                <ul id="logList" class="space-y-2 text-gray-300">
                    <li class="text-center text-gray-500 italic">Your study sessions will appear here.</li>
                </ul>
            </div>
            <!-- Weekly Analysis View -->
            <div id="view-weekly" class="hidden"></div>
            <!-- Monthly Analysis View -->
            <div id="view-monthly" class="hidden"></div>
        </div>

        <div class="mt-6 flex justify-between items-center border-t border-gray-700 pt-4">
             <div class="text-left">
                <p class="text-gray-400 text-sm">Total Time Studied</p>
                <p id="totalTime" class="text-2xl font-bold text-cyan-400 mt-1">00:00:00</p>
            </div>
            <button id="resetButton" class="text-sm bg-gray-700 hover:bg-red-500 text-white/80 hover:text-white font-semibold py-2 px-3 rounded-lg transition-colors">Clear All Data</button>
        </div>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const timerDisplay = document.getElementById('timer');
            const startButton = document.getElementById('startButton');
            const stopButton = document.getElementById('stopButton');
            const resetButton = document.getElementById('resetButton');
            const logList = document.getElementById('logList');
            const totalTimeDisplay = document.getElementById('totalTime');
            const subjectInput = document.getElementById('subjectInput');
            const subjectError = document.getElementById('subjectError');

            const tabs = document.querySelectorAll('.tab-button');
            const views = {
                today: document.getElementById('view-today'),
                weekly: document.getElementById('view-weekly'),
                monthly: document.getElementById('view-monthly'),
            };

            // State variables
            let startTime = 0;
            let intervalId = null;
            let isRunning = false;
            let currentSubject = '';
            let studySessions = JSON.parse(localStorage.getItem('studySessions')) || [];

            // --- Initialization ---
            function init() {
                updateTotalTime();
                renderView('today');
                stopButton.classList.add('opacity-50', 'cursor-not-allowed');
                
                startButton.addEventListener('click', startTimer);
                stopButton.addEventListener('click', stopTimer);
                resetButton.addEventListener('click', resetAllData);
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const viewName = tab.id.split('-')[1];
                        setActiveTab(viewName);
                        renderView(viewName);
                    });
                });
            }

            // --- Core Timer Functions ---
            function startTimer() {
                if (isRunning) return;
                
                const subject = subjectInput.value.trim();
                if (!subject) {
                    subjectError.textContent = 'Please enter a subject.';
                    return;
                }
                subjectError.textContent = '';
                currentSubject = subject;
                
                isRunning = true;
                startTime = Date.now();
                intervalId = setInterval(updateDisplay, 100);

                startButton.disabled = true;
                startButton.classList.add('opacity-50', 'cursor-not-allowed');
                stopButton.disabled = false;
                stopButton.classList.remove('opacity-50', 'cursor-not-allowed');
                subjectInput.disabled = true;
            }

            function stopTimer() {
                if (!isRunning) return;

                isRunning = false;
                clearInterval(intervalId);

                const elapsedTimeInSeconds = Math.round((Date.now() - startTime) / 1000);
                if (elapsedTimeInSeconds > 0) {
                    studySessions.push({
                        duration: elapsedTimeInSeconds,
                        subject: currentSubject,
                        date: new Date().toISOString()
                    });
                    saveData();
                    updateTotalTime();
                    renderView(getActiveTab());
                }

                timerDisplay.textContent = '00:00:00';
                subjectInput.value = '';
                
                startButton.disabled = false;
                startButton.classList.remove('opacity-50', 'cursor-not-allowed');
                stopButton.disabled = true;
                stopButton.classList.add('opacity-50', 'cursor-not-allowed');
                subjectInput.disabled = false;
            }

            function resetAllData() {
                if (isRunning) return;
                studySessions = [];
                saveData();
                updateTotalTime();
                renderView(getActiveTab());
            }

            // --- Data & State Management ---
            function saveData() {
                localStorage.setItem('studySessions', JSON.stringify(studySessions));
            }

            function getActiveTab() {
                return document.querySelector('.border-cyan-400').id.split('-')[1];
            }

            function setActiveTab(viewName) {
                tabs.forEach(tab => {
                    const isTarget = tab.id === `tab-${viewName}`;
                    tab.classList.toggle('border-cyan-400', isTarget);
                    tab.classList.toggle('text-cyan-400', isTarget);
                    tab.classList.toggle('border-transparent', !isTarget);
                    tab.classList.toggle('text-gray-400', !isTarget);
                });
            }

            // --- UI Rendering ---
            function updateDisplay() {
                const elapsedTime = Math.round((Date.now() - startTime) / 1000);
                timerDisplay.textContent = formatTime(elapsedTime);
            }

            function updateTotalTime() {
                const totalSeconds = studySessions.reduce((total, session) => total + session.duration, 0);
                totalTimeDisplay.textContent = formatTime(totalSeconds);
            }

            function renderView(viewName) {
                Object.values(views).forEach(v => v.classList.add('hidden'));
                views[viewName].classList.remove('hidden');

                switch (viewName) {
                    case 'today':
                        renderTodayLog();
                        break;
                    case 'weekly':
                        renderAnalysis('weekly');
                        break;
                    case 'monthly':
                        renderAnalysis('monthly');
                        break;
                }
            }

            function renderTodayLog() {
                logList.innerHTML = '';
                const today = new Date().toISOString().slice(0, 10);
                const todaysSessions = studySessions.filter(s => s.date.slice(0, 10) === today);

                if (todaysSessions.length === 0) {
                    logList.innerHTML = '<li class="text-center text-gray-500 italic">No study sessions logged today.</li>';
                    return;
                }

                todaysSessions.reverse().forEach(session => {
                    const li = document.createElement('li');
                    li.className = 'flex justify-between items-center bg-gray-700/50 p-2 rounded-md';
                    li.innerHTML = `
                        <span class="font-semibold text-cyan-300">${session.subject}</span>
                        <span class="font-medium">${formatTime(session.duration)}</span>
                    `;
                    logList.appendChild(li);
                });
            }

            function renderAnalysis(period) {
                const view = views[period];
                const data = aggregateDataBySubject(period);
                const totalPeriodSeconds = Object.values(data).reduce((sum, s) => sum + s, 0);

                if (Object.keys(data).length === 0) {
                    view.innerHTML = `<p class="text-center text-gray-500 italic">No data for this ${period}.</p>`;
                    return;
                }

                let html = `<div class="space-y-4">`;
                const maxSeconds = Math.max(...Object.values(data));

                for (const [subject, seconds] of Object.entries(data).sort(([,a],[,b]) => b - a)) {
                    const percentage = maxSeconds > 0 ? (seconds / maxSeconds) * 100 : 0;
                    html += `
                        <div class="grid grid-cols-4 gap-2 items-center text-sm">
                            <span class="col-span-1 truncate font-medium">${subject}</span>
                            <div class="col-span-2 bg-gray-700 rounded-full h-4">
                                <div class="bg-cyan-500 h-4 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <span class="col-span-1 text-right font-semibold">${formatTime(seconds)}</span>
                        </div>
                    `;
                }
                html += `</div>`;
                view.innerHTML = html;
            }

            // --- Analysis & Helper Functions ---
            function aggregateDataBySubject(period) {
                const now = new Date();
                let filteredSessions;

                if (period === 'weekly') {
                    const firstDayOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
                    firstDayOfWeek.setHours(0, 0, 0, 0);
                    filteredSessions = studySessions.filter(s => new Date(s.date) >= firstDayOfWeek);
                } else { // monthly
                    const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                    filteredSessions = studySessions.filter(s => new Date(s.date) >= firstDayOfMonth);
                }
                
                return filteredSessions.reduce((acc, session) => {
                    acc[session.subject] = (acc[session.subject] || 0) + session.duration;
                    return acc;
                }, {});
            }

            function formatTime(totalSeconds) {
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }

            init();
        });
    </script>
</body>
</html>

